version: "3.9"

services:
  framepack:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        UID: ${UID}
        GID: ${GID}
        MAX_JOBS: ${MAX_JOBS}
    image: framepack-sage-cu128:latest
    container_name: framepack
    ports:
      - "7860:7860"
    volumes:
      - hf_models:/app/hf_download
      - ./outputs:/app/outputs
      - ./models:/app/models
      # ðŸ‘‡ Mount WSL CUDA driver stubs so -lcuda can be found
      - /usr/lib/wsl/lib:/usr/lib/wsl/lib:ro
    environment:
      - UID=${UID}
      - GID=${GID}
      - HF_HOME=/app/hf_download
      - CLI_ARGS=--share --server 0.0.0.0
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      - LD_LIBRARY_PATH=/usr/lib/wsl/lib:${LD_LIBRARY_PATH}
    env_file:
      - .env
    restart: unless-stopped
    stdin_open: true
    tty: true
    gpus: all   # ðŸ‘ˆ Compose v2 GPU passthrough

volumes:
  hf_models:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: ${HF_MODELS_PATH}
